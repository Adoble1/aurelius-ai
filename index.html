<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animus Engine: Marcus Aurelius</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-bubble {
            max-width: 75%;
            word-wrap: break-word;
        }
        .user-bubble {
            background-color: #3B82F6; /* blue-500 */
        }
        .ai-bubble {
            background-color: #4B5563; /* gray-600 */
        }
        .dot-flashing {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #9CA3AF;
            color: #9CA3AF;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: .5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
        }
        .dot-flashing::before {
            left: -15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #9CA3AF;
            color: #9CA3AF;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #9CA3AF;
            color: #9CA3AF;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }
        @keyframes dotFlashing {
            0% { background-color: #9CA3AF; }
            50%, 100% { background-color: rgba(156, 163, 175, 0.2); }
        }
        #waitlist-modal.hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl h-[85vh] flex flex-col bg-gray-800 rounded-2xl shadow-2xl">
        <header class="bg-gray-700 p-4 rounded-t-2xl border-b border-gray-600 flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h6m-6 4h6m-6 4h6m-6 4h6m-6-8a1 1 0 01-1-1V7a1 1 0 112 0v1a1 1 0 01-1 1z"/></svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Animus Engine</h1>
                    <p class="text-sm text-gray-400">Conversing with Marcus Aurelius</p>
                </div>
            </div>
            <button id="create-own-btn" class="text-sm bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                Create Your Own
            </button>
        </header>

        <main id="chat-window" class="flex-1 p-6 overflow-y-auto space-y-6">
            <div class="flex items-start space-x-3">
                <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h6m-6 4h6m-6 4h6m-6 4h6m-6-8a1 1 0 01-1-1V7a1 1 0 112 0v1a1 1 0 01-1 1z"/></svg>
                </div>
                <div class="ai-bubble p-4 rounded-2xl text-white">
                    <p>Greetings. I am a model of the mind of Marcus Aurelius, grounded in the principles of Stoicism as recorded in *Meditations*. Pose a question about virtue, resilience, or the nature of existence, and I shall answer as he would.</p>
                </div>
            </div>
        </main>

        <footer class="p-4 border-t border-gray-600">
             <div class="flex justify-center space-x-2 mb-3">
                <button id="summarize-btn" class="text-xs bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-3 rounded-lg transition duration-300">
                    ✨ Summarize
                </button>
                <button id="socratic-btn" class="text-xs bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-3 rounded-lg transition duration-300">
                    ✨ Ask Me a Question
                </button>
            </div>
            <form id="chat-form" class="flex items-center space-x-3">
                <input id="user-input" type="text" placeholder="Ask about virtue, loss, duty..." class="w-full bg-gray-700 border border-gray-600 rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" autocomplete="off">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-5 rounded-xl transition duration-300 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" /></svg>
                </button>
            </form>
        </footer>
    </div>

    <!-- Waitlist Modal -->
    <div id="waitlist-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div id="waitlist-card" class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-8 text-center relative">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold mb-2">Build Your Own Legacy</h2>
            <p class="text-gray-400 mb-6">This demo is an experiment. The true vision of Animus Engine is to provide a private, bespoke model of your own mind—your unique wisdom, preserved forever.</p>
            <form id="waitlist-form">
                <p class="text-sm text-gray-300 mb-4">Join the Founder's Circle waitlist to be notified when we launch.</p>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                    <input id="email-input" type="email" placeholder="your.email@example.com" class="w-full bg-gray-700 border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white flex-grow" required>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-5 rounded-lg transition duration-300">Join Waitlist</button>
                </div>
            </form>
            <div id="thank-you-message" class="hidden mt-6">
                <h3 class="text-xl font-bold text-green-400">Thank You</h3>
                <p class="text-gray-300">Your place is reserved. We will be in touch soon.</p>
            </div>
        </div>
    </div>


    <script>
        const meditationsCorpus = [
            "You have power over your mind — not outside events. Realize this, and you will find strength.",
            "The best revenge is to be unlike him who performed the injury.",
            "Waste no more time arguing about what a good man should be. Be one.",
            "The soul becomes dyed with the color of its thoughts.",
            "If you are distressed by anything external, the pain is not due to the thing itself, but to your estimate of it; and this you have the power to revoke at any moment.",
            "Very little is needed to make a happy life; it is all within yourself, in your way of thinking.",
            "He who lives in harmony with himself lives in harmony with the universe.",
            "The happiness of your life depends upon the quality of your thoughts.",
            "Do every act of your life as though it were the very last act of your life.",
            "The impediment to action advances action. What stands in the way becomes the way.",
            "Our life is what our thoughts make it.",
            "Accept the things to which fate binds you, and love the people with whom fate brings you together, but do so with all your heart.",
            "It is not death that a man should fear, but he should fear never beginning to live.",
            "When you arise in the morning, think of what a precious privilege it is to be alive - to breathe, to think, to enjoy, to love.",
            "The object of life is not to be on the side of the majority, but to escape finding oneself in the ranks of the insane.",
            "Never let the future disturb you. You will meet it, if you have to, with the same weapons of reason which today arm you against the present.",
        ];

        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const summarizeBtn = document.getElementById('summarize-btn');
        const socraticBtn = document.getElementById('socratic-btn');

        const createOwnBtn = document.getElementById('create-own-btn');
        const waitlistModal = document.getElementById('waitlist-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const waitlistForm = document.getElementById('waitlist-form');
        const waitlistCard = document.getElementById('waitlist-card');
        const thankYouMessage = document.getElementById('thank-you-message');


        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = userInput.value.trim();
            if (!question) return;

            addMessageToChat(question, 'user');
            userInput.value = '';
            
            showTypingIndicator();

            try {
                const answer = await getRAGResponse(question);
                removeTypingIndicator();
                addMessageToChat(answer, 'ai');
            } catch (error) {
                removeTypingIndicator();
                addMessageToChat('An error occurred. The path to wisdom is fraught with challenges. Try again.', 'ai');
                console.error("Error fetching AI response:", error);
            }
        });

        summarizeBtn.addEventListener('click', async () => {
            const chatHistory = getChatHistory();
            if (chatHistory.length < 2) {
                addMessageToChat('There is not yet enough conversation to summarize. Let us first discuss what is on your mind.', 'ai');
                return;
            }
            
            showTypingIndicator();
            const prompt = `You are an AI emulating Marcus Aurelius. Below is a conversation transcript. Provide a concise summary of the key Stoic themes and lessons discussed. Respond in a wise, reflective tone, as if writing in your personal journal.\n\nTranscript:\n${chatHistory}`;
            
            try {
                const summary = await callGeminiAPI(prompt);
                removeTypingIndicator();
                addMessageToChat(summary, 'ai');
            } catch (error) {
                removeTypingIndicator();
                addMessageToChat('I find myself unable to distill our discourse at this moment. Let us try again later.', 'ai');
                console.error("Error fetching summary:", error);
            }
        });

        socraticBtn.addEventListener('click', async () => {
            const lastUserMessage = getLastUserMessage();
            if (!lastUserMessage) {
                addMessageToChat('You must first ask a question before I can challenge you to look deeper.', 'ai');
                return;
            }
            
            showTypingIndicator();
            const prompt = `You are an AI emulating Marcus Aurelius. A user has posed the following thought: "${lastUserMessage}". Instead of answering directly, you must respond with a single, profound Socratic question that encourages them to look inward and examine their own assumptions from a Stoic perspective.`;

            try {
                const question = await callGeminiAPI(prompt);
                removeTypingIndicator();
                addMessageToChat(question, 'ai');
            } catch (error) {
                removeTypingIndicator();
                addMessageToChat('At times, silence is the best question. Let us pause and reflect.', 'ai');
                console.error("Error fetching Socratic question:", error);
            }
        });

        // Waitlist Modal Logic
        createOwnBtn.addEventListener('click', () => {
            waitlistModal.classList.remove('hidden');
        });

        closeModalBtn.addEventListener('click', () => {
            waitlistModal.classList.add('hidden');
        });
        
        waitlistModal.addEventListener('click', (e) => {
            if (e.target === waitlistModal) {
                 waitlistModal.classList.add('hidden');
            }
        });

        waitlistForm.addEventListener('submit', (e) => {
            e.preventDefault();
            // In a real app, you would send the email to a server.
            // For this demo, we just show a thank you message.
            waitlistForm.classList.add('hidden');
            thankYouMessage.classList.remove('hidden');
        });


        function addMessageToChat(text, sender, role = 'user') {
            const messageWrapper = document.createElement('div');
            const bubble = document.createElement('div');
            const iconWrapper = document.createElement('div');
            
            iconWrapper.className = 'w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0';
            bubble.className = 'chat-bubble p-4 rounded-2xl text-white';
            bubble.dataset.sender = sender;


            if (sender === 'user') {
                messageWrapper.className = 'flex items-start justify-end';
                bubble.classList.add('user-bubble');
                bubble.innerHTML = `<p>${text}</p>`;
                messageWrapper.appendChild(bubble);
            } else {
                messageWrapper.className = 'flex items-start space-x-3';
                bubble.classList.add('ai-bubble');
                bubble.innerHTML = `<p>${text}</p>`;
                if (sender === 'ai') {
                     iconWrapper.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h6m-6 4h6m-6 4h6m-6 4h6m-6-8a1 1 0 01-1-1V7a1 1 0 112 0v1a1 1 0 01-1 1z"/></svg>`;
                }
                messageWrapper.appendChild(iconWrapper);
                messageWrapper.appendChild(bubble);
            }

            chatWindow.appendChild(messageWrapper);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
        
        function showTypingIndicator() {
            const typingWrapper = document.createElement('div');
            typingWrapper.id = 'typing-indicator';
            typingWrapper.className = 'flex items-start space-x-3';
            typingWrapper.innerHTML = `
                <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h6m-6 4h6m-6 4h6m-6 4h6m-6-8a1 1 0 01-1-1V7a1 1 0 112 0v1a1 1 0 01-1 1z"/></svg>
                </div>
                <div class="ai-bubble p-4 rounded-2xl flex items-center justify-center">
                    <div class="dot-flashing"></div>
                </div>
            `;
            chatWindow.appendChild(typingWrapper);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }
        
        async function callGeminiAPI(fullPrompt) {
            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{
                    parts: [{ text: fullPrompt }]
                }]
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];
            
            if (candidate && candidate.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                throw new Error("Invalid response structure from API.");
            }
        }

        async function getRAGResponse(question) {
            const relevantContext = findMostRelevantQuote(question);
            const systemPrompt = `You are an AI emulating the Stoic philosopher Marcus Aurelius. Your knowledge is based solely on the principles in *Meditations*. Your tone should be wise, concise, and focused on virtue, reason, and acceptance of nature. You never use modern jargon. A user has asked a question. You have recalled a relevant passage from your meditations to guide your answer.
            Relevant Passage: "${relevantContext}"
            Based on this passage and your core Stoic principles, formulate a response to the user's question. Answer as Marcus Aurelius.`;
            const userQuery = `The question is: "${question}"`;

            return await callGeminiAPI(`${systemPrompt}\n\n${userQuery}`);
        }

        function findMostRelevantQuote(question) {
            const questionWords = new Set(question.toLowerCase().split(/\s+/));
            let bestMatch = meditationsCorpus[0];
            let maxScore = 0;

            meditationsCorpus.forEach(quote => {
                const quoteWords = new Set(quote.toLowerCase().split(/\s+/));
                let score = 0;
                questionWords.forEach(word => {
                    if (quoteWords.has(word)) {
                        score++;
                    }
                });
                if (score > maxScore) {
                    maxScore = score;
                    bestMatch = quote;
                }
            });

            return bestMatch;
        }

        function getChatHistory() {
            const messages = [];
            document.querySelectorAll('#chat-window .chat-bubble').forEach(bubble => {
                const sender = bubble.dataset.sender === 'user' ? 'User' : 'AI';
                // Exclude the initial greeting
                if (bubble.innerText.includes('Greetings. I am a model of the mind')) return;
                messages.push(`${sender}: ${bubble.innerText}`);
            });
            return messages.join('\n');
        }

        function getLastUserMessage() {
            const bubbles = document.querySelectorAll('#chat-window .chat-bubble[data-sender="user"]');
            if (bubbles.length === 0) return null;
            return bubbles[bubbles.length - 1].innerText;
        }

    </script>
</body>
</html>

